<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>张恒的博客</title>
  
  
  <link href="http://zhanghengsjtu.github.io/atom.xml" rel="self"/>
  
  <link href="http://zhanghengsjtu.github.io/"/>
  <updated>2021-07-24T22:22:26.186Z</updated>
  <id>http://zhanghengsjtu.github.io/</id>
  
  <author>
    <name>张恒</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>moveit仿真</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/25/moveit%E4%BB%BF%E7%9C%9F/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/25/moveit%E4%BB%BF%E7%9C%9F/</id>
    <published>2021-07-24T22:21:42.000Z</published>
    <updated>2021-07-24T22:22:26.186Z</updated>
    
    <content type="html"><![CDATA[<p>moveit学习</p>]]></content>
    
    
    <summary type="html">ROS学习记录</summary>
    
    
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/tags/ROS/"/>
    
  </entry>
  
  <entry>
    <title>ROS仿真：ros_control+gazebo</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/22/ROS%E4%BB%BF%E7%9C%9F%EF%BC%9Aros_control+gazebo/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/22/ROS%E4%BB%BF%E7%9C%9F%EF%BC%9Aros_control+gazebo/</id>
    <published>2021-07-22T09:44:14.000Z</published>
    <updated>2021-07-26T19:27:52.422Z</updated>
    
    <content type="html"><![CDATA[<p>用ROS仿真机器人时，无外乎传感器和机器人，而这些硬件在gazebo中都集成了很好的插件。</p><h2 id="传感器仿真"><a href="#传感器仿真" class="headerlink" title="传感器仿真"></a><a href="http://gazebosim.org/tutorials?tut=ros_gzplugins">传感器仿真</a></h2><p>传感器仿真分为两步，首先在urdf中建立传感器的模型，然后在urdf中指定传感器对应的gazebo插件即可（注意在gazebo中传感器是依附在某一个连杆上的）。</p><p>基本上常见的传感器都可以在gazebo中找到对应的插件，使用的方法也很简单。配置如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span>&gt;</span></span><br><span class="line">  ... robot description ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;sensor_link&quot;</span>&gt;</span></span><br><span class="line">    ... link description ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">&quot;sensor_link&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sensor</span> <span class="attr">type</span>=<span class="string">&quot;camera&quot;</span> <span class="attr">name</span>=<span class="string">&quot;camera1&quot;</span>&gt;</span></span><br><span class="line">      ... sensor parameters ...</span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;camera_controller&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_camera.so&quot;</span>&gt;</span></span><br><span class="line">        ... plugin parameters ..</span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sensor</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Gazebo中提供的常见传感器列表如下：</p><ol><li><strong>Camera</strong>： provides ROS interface for simulating cameras such as wge100_camera by publishing the CameraInfo and Image ROS messages as described in sensor_msgs.</li><li><strong>Multicamera</strong>： synchronizes multiple camera’s shutters such that they publish their images together. Typically used for stereo cameras, uses a very similar interface as the plain Camera plugin and currently only supports stereo cameras.</li><li><strong>Depth Camera</strong>: simulates a sensor like a Kinect, which is duplicated in the Kinect plugin.</li><li><strong>GPU Laser</strong>: simulates laser range sensor by broadcasting LaserScan message as described in sensor_msgs.</li><li><strong>Laser</strong>: the non-GPU version of GPU Laser, but essentially uses the same code.</li><li><strong>Block Laser</strong>: provides grid style laser range scanner simulation (e.g. Velodyne).</li><li><strong>Force</strong>: ROS interface for applying Wrench (geometry_msgs) on a body in simulation.</li><li><strong>IMU</strong>: simulates IMU sensor. Measurements are computed by the ROS plugin or by Gazebo.</li></ol><h2 id="机器人仿真"><a href="#机器人仿真" class="headerlink" title="机器人仿真"></a>机器人仿真</h2><p>讲机器人仿真之前，先来介绍一下ros_control，因为这个模块和机器人仿真有非常大的关系。</p><h3 id="ROS-CONTROL"><a href="#ROS-CONTROL" class="headerlink" title="ROS_CONTROL"></a>ROS_CONTROL</h3><p>ros_control是ros为机器人开发者提供的机器人控制中间件，包含一系列控制器接口，传动装置接口，硬件接口，控制器工具等，帮助机器人应用快速落地，提高开发效率。整体框架如下：<img src="https://raw.githubusercontent.com/zhanghengsjtu/figureBed/main/img/20210724145002.png" alt="ros_control框架"></p><p>可以看到整个ros_control分成了五个部分，每个部分的功能解释如下。</p><ol><li><p><strong>controller magager控制器管理器</strong>: 作用就是加载控制器以及控制器对应的参数；比如通过yaml和launch文件可以加载一个二连杆机械臂的控制器。其中yaml文件指定了控制器的名称和参数，launch文件中通过<code>node name=&quot;controller_spawner&quot; pkg=&quot;controller_manager&quot; type=&quot;spawner&quot; args=&quot;...&quot;/&gt;</code>来加载yaml中指定的控制器。</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MYROBOT_control/config/rrbot_control.yaml</span></span><br><span class="line"><span class="attr">rrbot:</span></span><br><span class="line">    <span class="comment"># Publish all joint states -----------------------------------</span></span><br><span class="line">    <span class="attr">joint_state_controller:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">joint_state_controller/JointStateController</span></span><br><span class="line">        <span class="attr">publish_rate:</span> <span class="number">50</span>  </span><br><span class="line"></span><br><span class="line">    <span class="comment"># Position Controllers ---------------------------------------</span></span><br><span class="line">    <span class="attr">joint1_position_controller:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">effort_controllers/JointPositionController</span></span><br><span class="line">        <span class="attr">joint:</span> <span class="string">joint1</span></span><br><span class="line">        <span class="attr">pid:</span> &#123;<span class="attr">p:</span> <span class="number">100.0</span>, <span class="attr">i:</span> <span class="number">0.01</span>, <span class="attr">d:</span> <span class="number">10.0</span>&#125;</span><br><span class="line">    <span class="attr">joint2_position_controller:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">effort_controllers/JointPositionController</span></span><br><span class="line">        <span class="attr">joint:</span> <span class="string">joint2</span></span><br><span class="line">        <span class="attr">pid:</span> &#123;<span class="attr">p:</span> <span class="number">100.0</span>, <span class="attr">i:</span> <span class="number">0.01</span>, <span class="attr">d:</span> <span class="number">10.0</span>&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># MYROBOT_control/launch/MYROBOT_control.launch</span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Load joint controller configurations from YAML file to parameter server --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find rrbot_control)/config/rrbot_control.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- load the controllers --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;controller_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;controller_manager&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawner&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;/rrbot&quot;</span> <span class="attr">args</span>=<span class="string">&quot;joint1_position_controller joint2_position_controller joint_state_controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- convert joint states to TF transforms for rviz, etc --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;robot_state_publisher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;/joint_states&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/rrbot/joint_states&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>controller控制器</strong>: 就是上面yaml文件中<code>type</code>标签对应的类型，ros提供的控制器列表如下<br><img src="https://raw.githubusercontent.com/zhanghengsjtu/figureBed/main/img/20210726115435.png" alt="ros_controller list"></p><p> <strong>位置控制器</strong>:</p><ul><li>position_controller/JointPositionController: 输入关节位置，输出关节位置；</li><li>position_controller/JointGroupPositionController: 输入关节组位置，输出关节组位置；</li></ul><p> <strong>速度控制器</strong>:</p><ul><li>velocity_controller/JointVelocityController: 输入关节速度，输出关节速度；</li><li>velocity_controller/JointGroupVelocityController: 输入关节组速度，输出关节组速度；</li><li>velocity_controller/JointPositionController: 输入关节位置，输出关节速度，输入输出之间用PID调节；</li></ul><p> <strong>力矩控制器</strong>:</p><ul><li>effort_controller/JointEffortController：输入关节力矩，输出关节力矩；</li><li>effort_controller/JointGroupEffortController: 输入关节组力矩，输出关节组力矩；</li><li>effort_controller/JointVelocityController：输入关节速度，输出关节力矩，输入输出之间用PID调节；</li><li>effort_controller/JointPositionController：输入关节位置，输出关节力矩，输入输出之间用PID调节；</li><li>effort_controller/JointGroupPositionController: 输入关节组位置，输出关节组力矩，输入输出之间用PID调节；</li></ul><p> <strong>关节状态控制器</strong>:</p><ul><li>joint_state_controller/JointStateController: 关节状态控制器，作用是获取关节状态；</li></ul><p> <strong>关节轨迹控制器</strong>：可以理解成对关节位置，速度，力矩控制器的二次封装，作用是控制整个机器人关节组，和上面的JointGroup***Controller类似，但是上面的控制器提供的接口都是topic，而关节轨迹控制器提供的接口既有action，又有topic，便于和moveit等交互</p><ul><li>position_controller/JointTrajectoryController: 关节组轨迹位置控制器，输入关节组轨迹位置，输出关节组位置；</li><li>velocity_controller/JointTrajectoryController: 关节组轨迹速度控制器，输入关节组轨迹位置和速度，输出关节组速度，中间用PID+feedforward；</li><li>effort_controller/JointTrajectoryController: 关节组力矩控制器，输入关节组轨迹位置和速度，输出关节组力矩，中间用PID+feedforward；</li></ul><p> <strong>其他控制器</strong>：其他还有ackermann_steering_controller（专门针对汽车的），diff_drive_controller（差分移动机器人的）等，具体可以看各自的wiki介绍。</p></li><li><p><strong>hardware resource interface layer硬件接口</strong>: 这一层是软硬件的分界线，使得软硬件解耦。一方面接收硬件的信息如关节数据，另一方面可以将控制器计算出来的关节控制指令如力矩发送给硬件，目前ros提供的hardwareInterface接口如下，其实就是对应电机的三种运动模式（这个代表电机输入的信号类型，和上面的ros_controller的输出类型要一致）：</p><ul><li>hardware_interface/EffortJointInterface</li><li>hardware_interface/VelocityJointInterface</li><li>hardware_interface/PositionJointInterface</li></ul></li><li><p><strong>hardware interface硬件抽象</strong>: 该层的作用是兼容硬件多样性，同时为上层控制器提供与硬件交互的统一接口，具体功能可以是控制关节约束，力矩转换和状态转换等功能；</p></li><li><p><strong>hardware硬件</strong>: 具体的机器人硬件；</p><p> <strong>这里讲解ros_control架构的时候，是自上而下介绍的，上层的输出一般代表下层的输入。比如ros_controller的输入是用户上层应用，如moveit用FollowJointTrajectory来控制机械臂，或者用户想控制某个关节速度；ros_controller控制器的输出就是<code>hardware_interface</code>指定的类型，要么就是力矩，速度，位置，经过一些后处理发送给实际的机器人或者gazebo。</strong></p></li></ol><h3 id="ROS-CONTROL-GAZEBO"><a href="#ROS-CONTROL-GAZEBO" class="headerlink" title="ROS_CONTROL + GAZEBO"></a>ROS_CONTROL + GAZEBO</h3><p>有了上面对ros_control的理解之后，再来看一下其如何与gazebo仿真建立联系，两者之间的关系图如下<img src="https://raw.githubusercontent.com/zhanghengsjtu/figureBed/main/img/20210724141141.png" alt="gazebo+ros_control"></p><p>可以看到实际硬件和gazebo仿真的差异体现在4和5，即硬件抽象和具体硬件层。在仿真中，gazebo里面的机器人就代表硬件，左边的模块4为ros和gazebo之间沟通的桥梁。在该模块中，通过插件将ros和gazebo连接起来，具体的配置在下面会介绍。</p><h3 id="一般机器人仿真"><a href="#一般机器人仿真" class="headerlink" title="一般机器人仿真"></a>一般机器人仿真</h3><p>机器人仿真的过程也就是配置ros_control+gazebo的过程。配置过程和<code>ros_control</code>的讲解过程相反，是自下而上的，具体如下：</p><ul><li><p><strong>设置link标签</strong>：gazebo要求每个实际的link都要有inertial标签，同时link中的visual标签在gazebo中没用，需要单独配置零件的颜色；</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Base Link --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;link1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 $&#123;height1/2&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;$&#123;width&#125; $&#123;width&#125; $&#123;height1&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 $&#123;height1/2&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;$&#123;width&#125; $&#123;width&#125; $&#123;height1&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;orange&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 1&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">inertia</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ixx</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">ixy</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">ixz</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">iyy</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">iyz</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">izz</span>=<span class="string">&quot;1.0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">&quot;link1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Orange<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>设置joint标签</strong>：设置关节的阻尼等参数，以便进行动力学仿真；同时设置<code>transmission</code>标签，用来表示电机和关节的关系；为每个关节和电机配置<code>hardwareInterface</code>硬件接口，即上图中的模块3；</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;joint2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;continuous&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;link1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 $&#123;width&#125; $&#123;height2 - axel_offset*2&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">&quot;0 1 0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dynamics</span> <span class="attr">damping</span>=<span class="string">&quot;0.7&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">transmission</span> <span class="attr">name</span>=<span class="string">&quot;tran1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>transmission_interface/SimpleTransmission<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;$link1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hardwareInterface</span>&gt;</span>hardwareInterface/PositionJointInterface<span class="tag">&lt;/<span class="name">hardwareInterface</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">actuator</span> <span class="attr">name</span>=<span class="string">&quot;motor1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hardwareInterface</span>&gt;</span>hardwareInterface/PositionJointInterface<span class="tag">&lt;/<span class="name">hardwareInterface</span>&gt;</span> # indigo之后的版本可以不对电机设置，但必须对joint设置</span><br><span class="line">        <span class="tag">&lt;<span class="name">mechanicalReduction</span>&gt;</span>1<span class="tag">&lt;/<span class="name">mechanicalReduction</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">actuator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transmission</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>加载<code>libgazebo_ros_control.so</code>插件</strong>：即上面的模块4的一部分，插件的作用一方面是解析在urdf设置的<code>transmission</code>和<code>hardwareInterface</code>标签，加载合适的硬件接口，另一方面是ros和gazebo通讯的桥梁；之前研究过<code>libgazebo_ros_control.so</code><a href="https://github.com/ros-simulation/gazebo_ros_pkgs/blob/noetic-devel/gazebo_ros_control/src/default_robot_hw_sim.cpp">插件的源码</a>，里面把关节运动模式分成：EFFORT，POSITION，VELOCITY，POSITION_PID，VELOCITY_PID五种</p><ul><li><p>EFFORT：ros_controller输出的是力矩，该插件原封不动的用该力矩在gazebo中驱动关节；</p></li><li><p>POSITION_PID和VELOCITY_PID：ros_controller输出的是关节速度或者位置，同时为<code>libgazebo_ros_control.so</code>插件配置了PID参数，则将输入的关节位置和速度通过PID算法转换成关节力矩，再去驱动gazebo中的关节；注意这里的PID参数不是ros_controller的yaml文件中的参数；</p></li><li><p>POSITION和VELOCITY：ros_controller输出的是关节速度或者位置，同时没有为<code>libgazebo_ros_control.so</code>插件配置PID参数，此时关节会以最大扭矩驱动，迅速达到指定的速度或位置，这个最大扭矩是urdf中joint标签中设置的；</p></li><li><p><strong>默认情况下没有为<code>libgazebo_ros_control.so</code>插件配置关节速度和关节位置PID参数，因此第二种情况是进不去的。所以在仿真中我们就会发现，如果为关节指定了速度或者位置接口，仿真效果都比较理想，那是因为无论我们输入什么速度或位置，关节都以最大扭矩驱动（在urdf中往往也会为关节设置一个很大的扭矩），效果当然也就比较好；但是当为关节设置力矩接口时，机器人响应可能就不理想，那是因为ros_controller输出什么力矩，gazebo就以该扭矩驱动关节，所以压力就到ros_controller了。因此在这种情况下，需要花费精力调整ros_controller中的PID参数。</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;gazebo_ros_control&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_control.so&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">robotNamespace</span>&gt;</span>/arm<span class="tag">&lt;/<span class="name">robotNamespace</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>加载ros_controller</strong>：最后就是通过配置yaml和launch文件来加载ros_controller，注意加载的控制器需要和<code>hardwareInterface</code>适配，即如果<code>hardwareInterface</code>中配置的是位置控制接口，那么ros_controller也要加载位置控制器，具体可以参考<a href="http://gazebosim.org/tutorials?tut=ros_control&cat=connect_ros">官方例程</a>。</p></li></ul><p>通过配置不同控制器，就可以通过ros接口来控制gazebo中的机器人，比如通过话题控制某个关节，通过action控制整个机器人等。</p><p>注意在上述ros_control的配置，我们并没有涉及到机器人具体构型，而重点关注每个关节的运动，为每个关节提供了控制接口。因此上述配置方式理论上对任何构型的机器人都适用。</p><h3 id="移动机器人仿真"><a href="#移动机器人仿真" class="headerlink" title="移动机器人仿真"></a>移动机器人仿真</h3><p>我们上面讲了一般机器人的仿真，最核心的就是<code>libgazebo_ros_control.so</code>插件和关节控制器，其中插件负责ros和gazebo的通信并解析硬件接口，控制器负责实际的关节控制。然而插件和控制都不是一成不变的，下面我们通过移动机器人的例子看一下通过对<strong>插件</strong>和<strong>控制器</strong>的更改，来实现不同的仿真模式。</p><p>移动机器人的仿真有三种不同的方式：</p><ol><li><p>标准模式：使用标准的<code>libgazebo_ros_control.so</code>插件管理通信和解析硬件接口，然后为每个轮子加载一个速度控制器，此时用户需要手动管理移动机器人正逆运动学，里程计等信息（因为这个时候只能控制轮子）；</p></li><li><p>定制化<strong>控制器</strong>：通信和硬件接口解析，仍然使用标准的<code>libgazebo_ros_control.so</code>，但是在每个轮子的关节速度控制的基础上做了二次集成，开发了新的控制器。比如ros对移动机器人提供了ackermann_steering_controller和diff_drive_controller（简单测试了一下，不好用），这样就可以直接管理车子的速度和里程计信息了，而不是只控制轮子运动；</p></li><li><p><strong>定制化插件</strong>：在这种模式下，通信和硬件接口解析以及机器人控制器都在一个插件中完成了，这种方式集成度最高。此时，我们就不需要在urdf中加载<code>libgazebo_ros_control.so</code>，也不需要启动控制器管理器了，只需要在urdf中加载新的插件并进行响应的配置即可。目前ros对移动机器人提供了三个插件，介绍如下：</p></li></ol><h4 id="移动机器人gazebo插件"><a href="#移动机器人gazebo插件" class="headerlink" title="移动机器人gazebo插件"></a>移动机器人gazebo插件</h4><p>目前有差分，四驱和全向移动机器人，也可以自己定制</p><ul><li><p><strong>差分移动机器人</strong></p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;differential_drive_controller&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_diff_drive.so&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosDebugLevel</span>&gt;</span>Debug<span class="tag">&lt;/<span class="name">rosDebugLevel</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">publishWheelTF</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publishWheelTF</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">robotNamespace</span>&gt;</span>/<span class="tag">&lt;/<span class="name">robotNamespace</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">publishTf</span>&gt;</span>1<span class="tag">&lt;/<span class="name">publishTf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">publishWheelJointState</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publishWheelJointState</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">alwaysOn</span>&gt;</span>true<span class="tag">&lt;/<span class="name">alwaysOn</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">updateRate</span>&gt;</span>100.0<span class="tag">&lt;/<span class="name">updateRate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">legacyMode</span>&gt;</span>true<span class="tag">&lt;/<span class="name">legacyMode</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">leftJoint</span>&gt;</span>base_to_wheel_left_joint<span class="tag">&lt;/<span class="name">leftJoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rightJoint</span>&gt;</span>base_to_wheel_right_joint<span class="tag">&lt;/<span class="name">rightJoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wheelSeparation</span>&gt;</span>$&#123;base_link_radius*2&#125;<span class="tag">&lt;/<span class="name">wheelSeparation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wheelDiameter</span>&gt;</span>$&#123;2*wheel_radius&#125;<span class="tag">&lt;/<span class="name">wheelDiameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">broadcastTF</span>&gt;</span>1<span class="tag">&lt;/<span class="name">broadcastTF</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wheelTorque</span>&gt;</span>30<span class="tag">&lt;/<span class="name">wheelTorque</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wheelAcceleration</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">wheelAcceleration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commandTopic</span>&gt;</span>cmd_vel<span class="tag">&lt;/<span class="name">commandTopic</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">odometryFrame</span>&gt;</span>odom<span class="tag">&lt;/<span class="name">odometryFrame</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">odometryTopic</span>&gt;</span>odom<span class="tag">&lt;/<span class="name">odometryTopic</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">robotBaseFrame</span>&gt;</span>base_footprint<span class="tag">&lt;/<span class="name">robotBaseFrame</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  该插件的<a href="https://github.com/ros-simulation/gazebo_ros_pkgs/blob/kinetic-devel/gazebo_plugins/src/gazebo_ros_diff_drive.cpp">源码可以看这里</a>，可以看到插件的主要逻辑是：</p><ul><li>配置移动机器人基本参数，如轮子直径，轮距，坐标发布等；</li><li>接收/cmd_vel指令，即控制机器人的速度；</li><li>根据/cmd_vel的信息，更新/odom，然后将里程计信息发布出去；</li><li>根据小车的集合信息，计算出每个轮子的状态，更新/joint_states;</li></ul></li><li><p><strong>四驱移动机器人</strong></p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;skid_steer_drive_controller&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_skid_steer_drive.so&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">updateRate</span>&gt;</span>100.0<span class="tag">&lt;/<span class="name">updateRate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">robotNamespace</span>&gt;</span>/<span class="tag">&lt;/<span class="name">robotNamespace</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">leftFrontJoint</span>&gt;</span>front_left_wheel_joint<span class="tag">&lt;/<span class="name">leftFrontJoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rightFrontJoint</span>&gt;</span>front_right_wheel_joint<span class="tag">&lt;/<span class="name">rightFrontJoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">leftRearJoint</span>&gt;</span>back_left_wheel_joint<span class="tag">&lt;/<span class="name">leftRearJoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rightRearJoint</span>&gt;</span>back_right_wheel_joint<span class="tag">&lt;/<span class="name">rightRearJoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wheelSeparation</span>&gt;</span>0.4<span class="tag">&lt;/<span class="name">wheelSeparation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wheelDiameter</span>&gt;</span>0.215<span class="tag">&lt;/<span class="name">wheelDiameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">robotBaseFrame</span>&gt;</span>base_link<span class="tag">&lt;/<span class="name">robotBaseFrame</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">torque</span>&gt;</span>20<span class="tag">&lt;/<span class="name">torque</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">topicName</span>&gt;</span>cmd_vel<span class="tag">&lt;/<span class="name">topicName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">broadcastTF</span>&gt;</span>false<span class="tag">&lt;/<span class="name">broadcastTF</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>全向移动机器人</strong>： model plugin that allows arbitrary objects (for instance cubes, spheres and cylinders) to be moved along a horizontal plane using a geometry_msgs/Twist message. The plugin works by imparting a linear velocity (XY) and an angular velocity (Z) to the object every cycle.<br>Here is a full URDF example that demonstrates how to control a floating box inside gazebo using this plugin, using different visual and collision elements. Note: The object needs to have sufficient inertia to prevent undesirable motions - which can occur as a reaction to the supplied velocity. You can try increasing inertia until the object moves as desired. It is also good to have the center of mass close to the ground. （<strong>因为里面没有活动关节，所以不需要对关节设置传动</strong>）</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;test_model&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- root link, on the ground just below the model origin --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base_footprint&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;0.001 0.001 0.001&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;base_link_joint&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0.0 0 1.25&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;base_footprint&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- the model --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base_link&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">&quot;50&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 -1.25&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">&quot;50.0&quot;</span> <span class="attr">ixy</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">ixz</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">iyy</span>=<span class="string">&quot;50.0&quot;</span> <span class="attr">iyz</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">izz</span>=<span class="string">&quot;50.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;0.5 0.5 1.0&quot;</span> /&gt;</span> <span class="comment">&lt;!-- does not need to match collision --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 -1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">length</span>=<span class="string">&quot;0.5&quot;</span> <span class="attr">radius</span>=<span class="string">&quot;0.25&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;object_controller&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_planar_move.so&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commandTopic</span>&gt;</span>cmd_vel<span class="tag">&lt;/<span class="name">commandTopic</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">odometryTopic</span>&gt;</span>odom<span class="tag">&lt;/<span class="name">odometryTopic</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">odometryFrame</span>&gt;</span>odom<span class="tag">&lt;/<span class="name">odometryFrame</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">odometryRate</span>&gt;</span>20.0<span class="tag">&lt;/<span class="name">odometryRate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">robotBaseFrame</span>&gt;</span>base_footprint<span class="tag">&lt;/<span class="name">robotBaseFrame</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>传感器仿真比较简单，先为传感器建立urdf，然后再增加传感器插件和对应的参数即可。</p><p>一般机器人的仿真是建立在对ros_control理解的基础上的，通过对ros_control的配置，可以实现一般机器人的仿真。</p><p>移动机器人作为一种特殊的机器人，控制模式较为单一，构型也不复杂，因此ros提供了几种常见的插件来对其控制，相比ros_control的方式，使用定制化的插件配置简单，但劣势是一个插件只对一个固定构型的移动机器人有用。</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol><li><a href="http://wiki.ros.org/ros_control">http://wiki.ros.org/ros_control</a></li><li><a href="http://wiki.ros.org/ros_controllers">http://wiki.ros.org/ros_controllers</a></li><li><a href="http://wiki.ros.org/joint_trajectory_controller?distro=noetic">http://wiki.ros.org/joint_trajectory_controller?distro=noetic</a></li><li><a href="http://wiki.ros.org/urdf/XML/Transmission">http://wiki.ros.org/urdf/XML/Transmission</a></li><li><a href="http://gazebosim.org/tutorials/?tut=ros_control">http://gazebosim.org/tutorials/?tut=ros_control</a></li><li><a href="http://gazebosim.org/tutorials?tut=ros_gzplugins&amp;cat=connect_ros">http://gazebosim.org/tutorials?tut=ros_gzplugins&amp;cat=connect_ros</a></li><li><a href="http://docs.ros.org/en/jade/api/control_toolbox/html/classcontrol__toolbox_1_1Pid.html">http://docs.ros.org/en/jade/api/control_toolbox/html/classcontrol__toolbox_1_1Pid.html</a></li></ol>]]></content>
    
    
    <summary type="html">ROS学习记录</summary>
    
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/categories/ROS/"/>
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/tags/ROS/"/>
    
  </entry>
  
  <entry>
    <title>ROS仿真：Arbotix控制器</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/22/ROS%E4%BB%BF%E7%9C%9F%EF%BC%9AArbotix%E6%8E%A7%E5%88%B6%E5%99%A8/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/22/ROS%E4%BB%BF%E7%9C%9F%EF%BC%9AArbotix%E6%8E%A7%E5%88%B6%E5%99%A8/</id>
    <published>2021-07-22T08:59:25.000Z</published>
    <updated>2021-07-26T05:19:14.772Z</updated>
    
    <content type="html"><![CDATA[<p>ArbotiX是一款控制电机、舵机的控制板，并提供相应的ROS功能包，但是这个功能包不仅可以驱动真实的ArbotiX控制板，还提供了仿真控制器。这样的话，就可以基于ArbotiX+Rviz实现机器人的仿真，当然更加复杂的仿真，还是推荐ros_control+gazebo。</p><p>ArbotiX主要包含以下两个功能包：</p><h4 id="arbotix-python"><a href="#arbotix-python" class="headerlink" title="arbotix_python"></a><a href="http://wiki.ros.org/arbotix_python">arbotix_python</a></h4><p>提供了两个控制器</p><ol><li><p><a href="http://wiki.ros.org/arbotix_python/diff_controller">differ_controller</a>: 差速控制移动机器人，接收<code>/cmd_vel</code>，并更新<code>odom → base_link</code>的坐标关系，典型配置如下：</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">controllers:</span> &#123;</span><br><span class="line">    <span class="attr">base_controller:</span> &#123;<span class="attr">type:</span> <span class="string">diff_controller</span>, <span class="attr">base_width:</span> <span class="number">0.381</span>, <span class="attr">ticks_meter:</span> <span class="number">81807</span>, <span class="attr">Kp:</span> <span class="number">10</span>, <span class="attr">Kd:</span> <span class="number">0</span>, <span class="attr">Ki:</span> <span class="number">0</span>, <span class="attr">Ko:</span> <span class="number">25</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><a href="http://wiki.ros.org/arbotix_python/follow_controller">follow_controller</a>: 使用action交互的控制接口，可以当做moveit中FollowJointTrajectory这个action的server，典型的配置如下：</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">joints:</span> &#123;</span><br><span class="line"><span class="attr">joint1:</span> &#123;<span class="attr">id:</span> <span class="number">1</span>, <span class="attr">neutral:</span> <span class="number">205</span>, <span class="attr">max_angle:</span> <span class="number">169.6</span>, <span class="attr">min_angle:</span> <span class="number">-169.6</span>, <span class="attr">max_speed:</span> <span class="number">90</span>&#125;,</span><br><span class="line"><span class="attr">joint2:</span> &#123;<span class="attr">id:</span> <span class="number">2</span>, <span class="attr">max_angle:</span> <span class="number">134.6</span>, <span class="attr">min_angle:</span> <span class="number">-134.6</span>, <span class="attr">max_speed:</span> <span class="number">90</span>&#125;,</span><br><span class="line"><span class="attr">joint3:</span> &#123;<span class="attr">id:</span> <span class="number">3</span>, <span class="attr">max_angle:</span> <span class="number">150.1</span>, <span class="attr">min_angle:</span> <span class="number">-150.1</span>, <span class="attr">max_speed:</span> <span class="number">90</span>&#125;,</span><br><span class="line"><span class="attr">joint4:</span> &#123;<span class="attr">id:</span> <span class="number">4</span>, <span class="attr">max_angle:</span> <span class="number">150.1</span>, <span class="attr">min_angle:</span> <span class="number">-150.1</span>, <span class="attr">max_speed:</span> <span class="number">90</span>&#125;,</span><br><span class="line"><span class="attr">joint5:</span> &#123;<span class="attr">id:</span> <span class="number">5</span>, <span class="attr">max_angle:</span> <span class="number">150.1</span>, <span class="attr">min_angle:</span> <span class="number">-150.1</span>, <span class="attr">max_speed:</span> <span class="number">90</span>&#125;,</span><br><span class="line"><span class="attr">joint6:</span> &#123;<span class="attr">id:</span> <span class="number">6</span>, <span class="attr">max_angle:</span> <span class="number">360</span>, <span class="attr">min_angle:</span> <span class="number">-360</span>, <span class="attr">max_speed:</span> <span class="number">90</span>&#125;,</span><br><span class="line"><span class="attr">finger_joint1:</span> &#123;<span class="attr">id:</span> <span class="number">7</span>, <span class="attr">max_speed:</span> <span class="number">90</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">controllers:</span> &#123;</span><br><span class="line">    <span class="attr">arm_controller:</span> &#123;<span class="attr">type:</span> <span class="string">follow_controller</span>, <span class="attr">joints:</span> [<span class="string">joint1</span>, <span class="string">joint2</span>, <span class="string">joint3</span>, <span class="string">joint4</span>, <span class="string">joint5</span>, <span class="string">joint6</span>], <span class="attr">action_name:</span> <span class="string">arm_controller/follow_joint_trajectory</span>, <span class="attr">onboard:</span> <span class="literal">False</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="arbotix-controller"><a href="#arbotix-controller" class="headerlink" title="arbotix_controller"></a><a href="http://wiki.ros.org/arbotix_controllers?distro=noetic">arbotix_controller</a></h4><p>主要用来控制gripper，包含三种控制器，了解即可。</p><ol><li>one_side_gripper_controller.py</li><li>parallel_gripper_controller.py</li><li>parallel_single_servo_controller.py</li></ol>]]></content>
    
    
    <summary type="html">ROS学习记录</summary>
    
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/categories/ROS/"/>
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/tags/ROS/"/>
    
  </entry>
  
  <entry>
    <title>ROS基础：命名空间和重映射</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/21/ROS%E5%9F%BA%E7%A1%80%EF%BC%9A%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%92%8C%E9%87%8D%E6%98%A0%E5%B0%84/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/21/ROS%E5%9F%BA%E7%A1%80%EF%BC%9A%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%92%8C%E9%87%8D%E6%98%A0%E5%B0%84/</id>
    <published>2021-07-21T05:55:25.000Z</published>
    <updated>2021-07-24T22:14:30.348Z</updated>
    
    <content type="html"><![CDATA[<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a><a href="http://wiki.ros.org/Names">命名空间</a></h3><p>ROS中主要有四种命名方式，分为基础，全局，相对和私有。</p><ol><li><strong>全局</strong>：开头有”/“的名称称为全局的命名空间，默认的全局命名空间为”/“，也可以通过以下方式设置；<ol><li>命令参数设置：<code>rosrun turtlesim turtlesim_node __ns:=/my</code></li><li>在launch文件中设置：<code>&lt;node pkg=&quot;turtlesim&quot; type=&quot;turtlesim_node&quot; name=&quot;turtlesim_node&quot; ns=&quot;sim1&quot;/&gt;</code></li><li>使用环境变量：<code>export ROS_PACKAGE=default-namespace</code></li></ol></li><li><strong>相对</strong>：开头没有”/“的名称。ROS会以全局命名空间+相对名称来对其解析。</li><li><strong>基础</strong>：用来描述资源自身，可以当做相对名称的一个子类；</li><li><strong>私有</strong>：和相对名称一样，私有名称不能够完全确定它们自身所在的命名空间，<strong>和相对名称的区别是　私有名称使用的不是默认命名空间，而是用它们的节点名称作为命名空间</strong>。每个节点内部都有一些资源，这些资源只与本节点相关，不会与其他节点打交道，这时候为了安全我们使用私有名称。</li></ol><p><img src="https://raw.githubusercontent.com/zhanghengsjtu/figureBed/main/img/20210722092411.png" alt="ROS命名空间"></p><p>可以看到节点名本身<code>“node_name”</code>只在私有名称中有效。这个<code>“node_name”</code>就是<code>ros::init(argc,argv,“node_name”)</code>中的<code>node_name</code>，可以通过launch文件覆盖。</p><h3 id="命名映射"><a href="#命名映射" class="headerlink" title="命名映射"></a><a href="http://wiki.ros.org/Remapping%20Arguments">命名映射</a></h3><p>命名映射的基本语法是： <code>name:=new_name</code>。同样的，重映射的规则与名称的全局和相对特性有关系。规则参考如下：<br><img src="https://raw.githubusercontent.com/zhanghengsjtu/figureBed/main/img/20210718223225.png" alt="ros命名映射"></p><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ol><li><a href="https://blog.csdn.net/jrc_january/article/details/76587630">https://blog.csdn.net/jrc_january/article/details/76587630</a></li><li><a href="http://wiki.ros.org/Names">http://wiki.ros.org/Names</a></li><li><a href="http://wiki.ros.org/Remapping%20Arguments">http://wiki.ros.org/Remapping%20Arguments</a></li></ol>]]></content>
    
    
    <summary type="html">ROS学习记录</summary>
    
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/categories/ROS/"/>
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/tags/ROS/"/>
    
  </entry>
  
  <entry>
    <title>ROS基础：catkin编译系统</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/21/ROS%E5%9F%BA%E7%A1%80%EF%BC%9Acatkin%E7%BC%96%E8%AF%91%E7%B3%BB%E7%BB%9F/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/21/ROS%E5%9F%BA%E7%A1%80%EF%BC%9Acatkin%E7%BC%96%E8%AF%91%E7%B3%BB%E7%BB%9F/</id>
    <published>2021-07-21T05:52:06.000Z</published>
    <updated>2021-07-26T05:19:57.004Z</updated>
    
    <content type="html"><![CDATA[<p>ROS使用catkin来管理包，它是对CMake的扩展。一个catkin软件包必须要有package.xml和CMakeLists.txt两个文件，前者包括了包的描述和依赖信息，后者是构建包的cmake文件。实际工作中，catkin工具会调用CMakeLists.txt，而生成makefile等文件。</p><h4 id="package-xml基本结构"><a href="#package-xml基本结构" class="headerlink" title="package.xml基本结构"></a><a href="http://wiki.ros.org/catkin/package.xml">package.xml基本结构</a></h4><p>一个典型的package.xml文件如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">format</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>your_package<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">    This package adds extra features to rosawesome.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maintainer</span> <span class="attr">email</span>=<span class="string">&quot;you@example.com&quot;</span>&gt;</span>Your Name<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">license</span>&gt;</span>BSD<span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>catkin<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">depend</span>&gt;</span>roscpp<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>angles<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build_export_depend</span>&gt;</span>angles<span class="tag">&lt;/<span class="name">build_export_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>openni_launch<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure><p>几个重要的标签，解释如下：</p><ol><li><code>buildtool_depend</code>: 编译工具，默认<code>catkin</code>，一般不用修改。</li><li><code>depend</code>：指定编译时的依赖项，包含<code>build_depend</code>，<code>build_export_depend</code>和<code>exec_depend</code>。</li><li><code>build_depend</code>: 指定编译功能包需要的依赖，例如<code>angle</code>包提供了C++头文件和编译文件。</li><li><code>build_export_depend</code>: 指定对功能包构建库需要的依赖，例如本功能包导出的头文件依赖了<code>&lt;angles/angles.h&gt;</code>，那么第三方包使用本包导出的头文件时，仍然需要<code>&lt;build_depend&gt;angles&lt;/build_depend&gt;</code>。</li><li><code>exec_depend</code>: 指定运行该功能包需要的依赖。</li><li><strong>建议</strong>：简单情况直接使用<code>depend</code>标签即可（一个顶仨），也不容易出错；如果是依赖的系统项，可以根据<a href="https://docs.ros.org/en/kinetic/api/catkin/html/howto/format2/index.html">官方建议</a>谨慎选择。</li></ol><h4 id="CMakeLists-txt的基本结构"><a href="#CMakeLists-txt的基本结构" class="headerlink" title="CMakeLists.txt的基本结构"></a><a href="http://wiki.ros.org/catkin/CMakeLists.txt">CMakeLists.txt的基本结构</a></h4><p>CMake是不知道package.xml中的依赖关系的，但是catkin知道，因此在CMakeLists.txt中需要对catkin合理配置，便于处理包的依赖关系。<br>CMakeLists.txt基本结构如下：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>.<span class="number">3</span>)</span><br><span class="line"><span class="keyword">project</span>(robot_brain)</span><br><span class="line"><span class="comment"># Get the information about this package&#x27;s buildtime dependencies</span></span><br><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED</span><br><span class="line">  COMPONENTS message_generation std_msgs sensor_msgs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Declare the message files to be built</span></span><br><span class="line">add_message_files(FILES</span><br><span class="line">  MyMessage.msg</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Declare the service files to be built</span></span><br><span class="line">add_service_files(FILES</span><br><span class="line">  MyService.srv</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Actually generate the language-specific message and service files</span></span><br><span class="line">generate_messages(DEPENDENCIES std_msgs sensor_msgs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Declare that this catkin package&#x27;s runtime dependencies</span></span><br><span class="line">catkin_package(</span><br><span class="line">  CATKIN_DEPENDS message_runtime std_msgs sensor_msgs</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(message_program src/main.cpp)</span><br><span class="line"><span class="keyword">add_dependencies</span>(message_program <span class="variable">$&#123;$&#123;PROJECT_NAME&#125;</span>_EXPORTED_TARGETS&#125; <span class="variable">$&#123;catkin_EXPORTED_TARGETS)</span></span><br><span class="line"><span class="variable">target_link_libraries(message_program $&#123;catkin_LIBRARIES&#125;</span> other_lib)</span><br></pre></td></tr></table></figure><p>重要的模块解释如下：</p><ol><li><code>find_package</code>: cmake宏，指定依赖的其他pacakge，实际是生成了一些环境变量，如NAME_FOUND，NAME_INCLUDE_DIRS, NAME_LIBRARYIS，此处catkin是必备依赖 其余的syd_msgs…为组件，这个里面的包在package.xml中一定要有<code>build_depend</code>标签。</li><li><code>catkin_package</code>：catkin宏，生成当前package的cmake配置，供依赖本包的其他软件包调用，同时这个命令必须在add_library()或者add_executable()之前调用；注意这个里面的包在package.xml一定要有<code>build_export_depend</code>标签。</li><li>其余为CMake自身语法，具体可以参考<a href="https://github.com/Akagi201/learning-cmake/blob/master/docs/cmake-practice.pdf">CMake学习资料</a>。</li></ol><h4 id="创建msg的注意事项"><a href="#创建msg的注意事项" class="headerlink" title="创建msg的注意事项"></a>创建msg的注意事项</h4><ul><li>在package.xml中<ol><li><code>&lt;build_depend&gt;message_generation&lt;/build_depend&gt;</code></li><li><code>&lt;build_export_depend&gt;message_runtime&lt;/build_export_depend&gt;</code></li><li><code>&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;</code></li></ol></li><li>在CMakeLists.txt中<ol><li>添加<code>find_package(messaga_generation)</code>，确保可以生成msg文件；</li><li>添加<code>catkin_package(message_runtime)</code>：确保生成的msgs文件可以被外部使用；</li><li>添加<code>add_message_file</code>，添加具体的文件名；</li><li>添加<code>generate_message</code>中的依赖包，如依赖<code>std_msgs</code></li></ol></li></ul>]]></content>
    
    
    <summary type="html">ROS学习记录</summary>
    
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/categories/ROS/"/>
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/tags/ROS/"/>
    
  </entry>
  
  <entry>
    <title>ROS基础：launch文件</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/18/ROS%E5%9F%BA%E7%A1%80%EF%BC%9Alaunch%E6%96%87%E4%BB%B6/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/18/ROS%E5%9F%BA%E7%A1%80%EF%BC%9Alaunch%E6%96%87%E4%BB%B6/</id>
    <published>2021-07-18T09:39:58.000Z</published>
    <updated>2021-07-26T05:21:20.847Z</updated>
    
    <content type="html"><![CDATA[<p>roslaunch的主要作用时启动多个节点，同时在参数服务器上设置参数。使用roslaunch时，会自动启动roscore。</p><h3 id="常见语法"><a href="#常见语法" class="headerlink" title="常见语法"></a>常见语法</h3><ol><li><code>$(find pkg)</code>: 获得包的相对路径；</li><li><code>$(arg foo)</code>: 计算<code>foo</code>的值，arg可以理解成launch文件的内部变量，args是node中传递给节点的参数；</li><li><code>if</code>和<code>unless</code>：所有标签都支持<code>if</code>和<code>unless</code>标签，用来作为条件判断；</li></ol><h3 id="launch标签"><a href="#launch标签" class="headerlink" title="launch标签"></a>launch标签</h3><ol><li><p>launch: 最大的标签，唯一的作用是作为launch容器，包含其他标签；</p></li><li><p>node: 启动节点的标签。launch文件不能保证里面指定的节点的启动顺序，这个是故意设计的，因为在外部无法知道一个节点何时完全初始化了，所以在写节点的时候，要充分考虑节点的启动顺序带来的安全性问题。</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;listener1&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;rospy_tutorials&quot;</span> <span class="attr">type</span>=<span class="string">&quot;listener&quot;</span> <span class="attr">args</span>=<span class="string">&quot;--test&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>include：加入另一个launch文件；</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find ur_description)/launch/ur5_bringup.launch&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>remap：参数重映射，可以参考<a href="https://zhanghengsjtu.github.io/2021/07/21/ROS%E5%9F%BA%E7%A1%80%EF%BC%9A%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%92%8C%E9%87%8D%E6%98%A0%E5%B0%84/">重映射博客</a>;</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;/different_topic&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/needed_topic&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>param: 设置参数服务器上的参数，可以使用<code>value, textfile, binfile, command</code>命令加载具体参数。如果该标签放在<code>node</code>下面，将被当做私有参数。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;publish_frequency&quot;</span> <span class="attr">type</span>=<span class="string">&quot;double&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10.0&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>rosparam: 将yaml文件设置为参数为参数服务器上的参数，同样的，如果该标签出现在<code>node</code>里面，将作为私有参数；</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> <span class="attr">file</span>=<span class="string">&quot;$(find ur_description)/config/kinematics.yaml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>arg: 作为launch文件的局部变量使用，使得launch文件的扩展性更强。一般利用arg在多个launch文件传递参数，或者为param设置值。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># my_file.launch</span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;included.launch&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- all vars that included.launch requires must be set --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;hoge&quot;</span> <span class="attr">value</span>=<span class="string">&quot;fuga&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># included.launch:</span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- declare arg to be passed in --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;hoge&quot;</span> /&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- read value of arg --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;param&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg hoge)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>group: 将节点归组，方便统一处理，比如设置命名空间等；</p></li><li><p>ns：设置命名空间，可以用在<code>node, include,group</code>中。</p></li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>launch文件在ros中使用非常频繁，语法琐碎且简单。使用时，建议直接从例程代码中直接修改，同时知道各个标签的含义，便于自己修改和定制化。</p><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ol><li><a href="http://wiki.ros.org/roslaunch">http://wiki.ros.org/roslaunch</a></li><li><a href="http://wiki.ros.org/roslaunch/Architecture">http://wiki.ros.org/roslaunch/Architecture</a></li><li><a href="http://wiki.ros.org/roslaunch/XML">http://wiki.ros.org/roslaunch/XML</a></li></ol>]]></content>
    
    
    <summary type="html">ROS学习记录</summary>
    
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/categories/ROS/"/>
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/tags/ROS/"/>
    
  </entry>
  
  <entry>
    <title>ROS基础：常用命令</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/18/ROS%E5%9F%BA%E7%A1%80%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/18/ROS%E5%9F%BA%E7%A1%80%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</id>
    <published>2021-07-18T09:34:44.000Z</published>
    <updated>2021-07-24T22:14:26.998Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$ROS_PACKAGE_PATH</span>  </span><br><span class="line"><span class="comment"># 打印ros环境变量，确保/opt/ros/kinetic/share和自己的工作空间在里面</span></span><br><span class="line"><span class="comment"># 同时注意ROS中存在工作空间覆盖的机制，即后设置的路径会放在ROS_PACKAGE_PATH前面</span></span><br><span class="line"><span class="comment"># 实际工作时，系统在ROS_PACKAGE_PATH中从前向后查找对应的包，找到即停止</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译相关</span></span><br><span class="line">catkin_init_workspace       <span class="comment"># 在一个空的文件夹下面初始化一个工作空间</span></span><br><span class="line">catkin_make                 <span class="comment"># 编译对应的工作空间</span></span><br><span class="line">catkin build -j4            <span class="comment"># 编译对应的工作空间，-j4指定用4个核，相比catkin_make，输出信息更丰富</span></span><br><span class="line">catkin_create_pkg pkg_name dep1 dep2 dep3   <span class="comment"># 创建包，并指定依赖</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 话题相关</span></span><br><span class="line">rosmsg show msg_type        <span class="comment"># 查看消息类型</span></span><br><span class="line">rostopic list               <span class="comment"># 查看话题名称</span></span><br><span class="line">rostopic <span class="built_in">type</span> topic_name    <span class="comment"># 查看话题数据类型</span></span><br><span class="line">rostopic hz topic_name      <span class="comment"># 查看话题数据频率</span></span><br><span class="line">rostopic <span class="built_in">echo</span> topic_name    <span class="comment"># 打印数据信息</span></span><br><span class="line">rostopic pub -r 10 topic_name data_type data    <span class="comment"># 发布数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务相关</span></span><br><span class="line">rossrv show srv_type        <span class="comment"># 查看服务类型</span></span><br><span class="line">rosservice list             <span class="comment"># 查看服务名称</span></span><br><span class="line">rosservice <span class="built_in">type</span> srv_name    <span class="comment"># 查看服务数据类型    </span></span><br><span class="line">rosservice call srv_name srv-args  <span class="comment"># 命令行请求服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rqt相关</span></span><br><span class="line">rqt_graph                   <span class="comment"># 显示节点话题服务关系</span></span><br><span class="line">rqt_plot                    <span class="comment"># 打印数据</span></span><br><span class="line">rosrun rqt_tf_tree rqt_tf_tree  <span class="comment"># 打印当前机器人的tf树</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tf相关</span></span><br><span class="line">tf_monitor /frame1 /frame2  <span class="comment"># 查看坐标系之间的关系</span></span><br><span class="line">tf_echo /frame1 /frame2     <span class="comment"># 打印frame2相对frame1的变换</span></span><br><span class="line">static_transform_publisher x y z yaw pitch roll (或 qx qy qz qw) frame_id child_frame_id period_in_ms   <span class="comment"># 静态发布两个坐标系之间的关系</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ROS学习记录</summary>
    
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/categories/ROS/"/>
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/tags/ROS/"/>
    
  </entry>
  
  <entry>
    <title>ROS基础：通讯和回调函数</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/18/ROS%E5%9F%BA%E7%A1%80%EF%BC%9A%E9%80%9A%E8%AE%AF%E5%92%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/18/ROS%E5%9F%BA%E7%A1%80%EF%BC%9A%E9%80%9A%E8%AE%AF%E5%92%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/</id>
    <published>2021-07-18T08:43:45.000Z</published>
    <updated>2021-07-24T22:08:57.309Z</updated>
    
    <content type="html"><![CDATA[<h3 id="通讯"><a href="#通讯" class="headerlink" title="通讯"></a>通讯</h3><p>ROS将每个进程看做一个节点，使用节点管理器进行统一管理，并提供一套响应的消息传递机制。在ROS中，所有的消息通信都必须使用节点管理器。ROS的特殊性主要体现在消息通讯层，而不是更深的层次。点对点的连接和配置通过XMLRPC机制实现；节点间的数据流通过网络套接字实现，数据流在ROS中被称为消息，模块间的消息传递采用简单的、语言无关的接口定义描述。</p><p>ROS的底层的通信是通过HTTP完成的，因此ROS内核本质上是有一个HTTP服务器，它的地址一般是 <code>http://localhost:11311/</code>，即本地的11311端口，当需要连接到另一台计算机上运行的ROS时，只要连上该机的11311端口即可。</p><p>ROS提供多种类型的通讯机制，包括基于主题的异步数据流通信、基于服务的同步RPC（远程过程调用）通信以及基于参数服务的数据传递，支持实现不同需求的网络连接。</p><h4 id="基于主题的异步数据流通信"><a href="#基于主题的异步数据流通信" class="headerlink" title="基于主题的异步数据流通信"></a>基于主题的异步数据流通信</h4><p>ROS中最主要的通信方式，它实现了节点间多对多的连接，并且采用单向数据流传输数据。通过主题可以实现发布者和订阅者之间的解耦。底层依赖于XMLRPC和TCP/UDP。步骤如下：</p><ol><li><strong>talker注册</strong>：使用RPC向master注册发布者的信息，包含发布消息的话题名；master将注册信息加入注册列表中；</li><li><strong>listener注册</strong>：使用RPC向master注册订阅者的信息，包含需要订阅的话题名；</li><li><strong>master信息匹配</strong>：根据listener的订阅信息查询注册列表，如果没找到，则等待发布者加入；如果找到了，通过RPC向listener发布talker的RPC地址；</li><li><strong>listener发送连接请求</strong>：listener收到talker的RPC地址之后，尝试通过RPC向talker发送连接请求，传输订阅的话题名，消息类型以及通讯协议（TCP/UDP）</li><li><strong>talker确认连接请求</strong>：talker收到listener发送的连接请求后，继续通过RPC向listener确认连接信息，其中包含自身的TCP地址信息；</li><li><strong>listener与talker建立网络连接</strong>：尝试使用TCP或UDP建立网络连接；</li><li><strong>talker向listener发布数据</strong>：成功建立连接之后，talker开始向listener发布数据；</li></ol><p>步骤1-5，使用的都是XMLRPC通信，其中步骤4和5，talker和listener会协商共同支持的协议（TCPROS或UDPROS），最后6-7才是真正的TCP或UDP通讯。</p><p><strong>XMLRPC</strong>：ROS节点之间建立连接过程及其与master之间通信均使用XMLRPC（基于XML的远程过程调用），这些远程过程调用采用HTTP传输协议，XML作为传输数据的编码格式。XML的文本属性使得它独立于传输层的编码形式，直接封装在HTTP中传输。远程过程调用的主要作用是负责节点对计算图级中的信息进行获取、更改及一些全局变量的设置，不直接支持数据的流传输。</p><p><strong>TCPROS和UDPROS</strong>：ROS主题通讯支持TCPROS和UDPROS两种通信协议，TCPROS采用标准的TCP/IP套接字，这是ROS默认的传输方式；UDPROS采用标准的UDP传输方式，它是一种低延时、高效率的传输方式，但可能产生数据丢失，所以它比较适用于远程操作任务。</p><h4 id="基于服务的同步RPC通信"><a href="#基于服务的同步RPC通信" class="headerlink" title="基于服务的同步RPC通信"></a>基于服务的同步RPC通信</h4><p>可以实现一对一的连接，采用请求应答的模型。步骤如下：</p><ol><li><strong>talker注册</strong>：使用RPC向master注册，包含提供的服务名；master将注册信息加入注册列表中；</li><li><strong>listener注册</strong>：同样通过RPC向master注册，包含需要查找的服务名；</li><li><strong>master信息匹配</strong>：master查询注册列表，没找到，则等待服务加入；<strong>找到的话，则通过RPC向listener发送talker的TCP地址</strong>；</li><li><strong>listener与talker建立网络连接</strong>：listener使用tcp尝试与talker建立网络连接，并发送服务请求数据；</li><li><strong>talker向listener发布数据</strong>：talker收到服务请求和参数之后，开始执行服务功能，执行完成后，向listener发送应答数据。</li></ol><p>可以看到，相比基于主题的异步数据流通信，该过程少了双方协商协议的过程，因为同步RPC通讯只支持TCPROS，客户端不需要通过XMLRPC与服务端协商共同支持的协议。</p><h4 id="参数服务器"><a href="#参数服务器" class="headerlink" title="参数服务器"></a>参数服务器</h4><p>参数服务器是一个可以通过网络访问的多元共享的参数字典，节点在运行时可以在参数服务器上存储或获取参数。参数服务器运行在节点管理器上，它的应用程序编程接口通过XMLRPC库进行访问。可以理解成ROS中的全局变量，只需要XMLRPC通讯，不用TCP，操作如下：</p><ol><li>talker设置参数</li><li>listener查询参数</li><li>master将查询结果返回给listener</li></ol><h4 id="动作action通讯"><a href="#动作action通讯" class="headerlink" title="动作action通讯"></a>动作action通讯</h4><p>带有响应机制的服务。相比于服务的阻塞特性，动作可以在服务端任务执行的过程中，反馈给客户端任务执行的状态，便于客户端查看进度并根据反馈结果作出合理响应。</p><h4 id="优缺点和注意事项"><a href="#优缺点和注意事项" class="headerlink" title="优缺点和注意事项"></a>优缺点和注意事项</h4><p>整体来讲，topic适合数据传输，service适合逻辑处理，action用在需要监视的场景，如实际机器人的轨迹执行。一般使用时都不会有问题，毕竟ROS还是一个很好的工具。但是如果数据量比较大或者回调函数运行时间很长，延时一般就不能忽略，此时就涉及到通讯中的回调函数的处理。</p><h3 id="回调函数和多线程"><a href="#回调函数和多线程" class="headerlink" title="回调函数和多线程"></a><a href="https://wiki.ros.org/roscpp/Overview/Callbacks%20and%20Spinning">回调函数和多线程</a></h3><p>在基于服务的通信中，客户端和服务端的连接每次都会经历一个查找和连接的过程，而且连接仅在此次服务调用期间有效，在调用返回后将被关闭。服务端回调函数每次只处理客户端发送的数据，并不需要维持一个回调函数队列，而且服务端和客户端的api中并没有回调函数队列长度参数。</p><p>但是在基于主题的异步数据流通讯中，订阅者无法确定消息的到达时间，所以利用回调函数，把响应收到消息事件的代码放到回调函数里。通过轮转函数实现回调函数的调用，从而实现消息处理。</p><p>ROS提供了三种形式的回调函数队列，分别是：</p><ol><li>每个订阅者的回调函数队列</li><li>每个NodeHandle的回调函数队列</li><li>全局回调函数队列，即节点的回调函数队列</li></ol><p>其中全局回调函数队列在创建节点时自动创建，前两种需要手动创建。当消息到达时，先查看订阅者回调队列，在查看NodeHandle回调队列，最后才查看全局回调队列。</p><h4 id="单线程轮询"><a href="#单线程轮询" class="headerlink" title="单线程轮询"></a>单线程轮询</h4><p>ros::spin()会导致用户编写的所有回调函数都被调用，并且一旦被调用，将不会返回，除非被关闭。使用ros::spin时，一般在初始化时，都设置好了所有消息的回调函数，并且不需要其他辅助程序运行。</p><p>ros::spinOnce调用后会及时返回，并且还可以继续执行之后的程序。它会在某个时间段内及时调用<strong>所有的回调函数</strong>。一般还需要其他辅助程序的执行，如定时任务，数据处理，用户界面等。</p><h4 id="多线程轮询"><a href="#多线程轮询" class="headerlink" title="多线程轮询"></a>多线程轮询</h4><p>ros::MulitiThreadSpinner，阻塞执行轮转，与ros::spin类似，执行后无需返回，直到节点被关闭。</p><p>ros::AsyncSpinner: 没有使用阻塞形式，而是包含了start和stop调用，这样编程人员可以随时打开或者停止在回调函数队列上的轮转，实际使用中，这个更有用。</p>]]></content>
    
    
    <summary type="html">ROS学习记录</summary>
    
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/categories/ROS/"/>
    
    
    <category term="ROS" scheme="http://zhanghengsjtu.github.io/tags/ROS/"/>
    
  </entry>
  
  <entry>
    <title>Markdown语法学习</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/17/Markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/17/Markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-07-17T10:46:14.000Z</published>
    <updated>2021-07-24T22:13:31.878Z</updated>
    
    <content type="html"><![CDATA[<h3 id="为什么选择Markdown"><a href="#为什么选择Markdown" class="headerlink" title="为什么选择Markdown"></a>为什么选择Markdown</h3><p>Markdown是一种纯文本格式的标记语言。通过简单的标记语法，它可以使普通文本内容具有一定的格式。</p><p>相比于印象笔记，有道云笔记和Word，Markdown的功能可以说是“大打折扣”，但是正式因为这种简介的语言格式，让我们能够更加回归内容本身，而不是去关注字体，颜色，排版等琐碎的细节。同时Markdown还有一个好处是很多网站都支持Markdown预览，非常方便。</p><p>Markdown的编辑器比较多，选择自己喜欢的即可，在这里我选择使用VSCode+Markdown插件，当然Typora也是非常好用的编辑器。不过还是刚刚讲的，使用Markdown是回归内容本身，选择自己用着顺手的编辑器即可。</p><h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3><p>语法主要包含以下几个方面：</p><ol><li><p><strong>标题</strong>：使用多个#表示不同的标题级别；</p></li><li><p><strong>列表</strong>：</p><ul><li>无序列表：使用-+*表示；</li><li>有序列表：使用1，2，3表示；</li><li>列表分级：上下级之间用三个空格；</li></ul></li><li><p><strong>字体</strong>：语法如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*斜体*</span><br><span class="line">**粗体**</span><br><span class="line">***斜体加粗***</span><br><span class="line">~~删除线~~</span><br></pre></td></tr></table></figure><p>结果如下：<br> <em>斜体</em><br> <strong>粗体</strong><br> <em><strong>斜体加粗</strong></em><br> <del>删除线</del></p></li><li><p><strong>超链接</strong>：形式为 <code>[超链接名](超链接地址 &quot;超链接title&quot;)</code>，如<code>[个人博客]（https://zhanghengsjtu.github.io/）</code></p></li><li><p><strong>代码</strong></p><ul><li>单行代码：左右各一个反引号`</li><li>代码块：左右各三个反引号`，且两边的三个反引号独占一行</li></ul></li><li><p><strong>图片和图床</strong>：基础语法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">![图注](图片地址 &#x27;&#x27;悬浮标题&#x27;&#x27;)</span><br><span class="line">图注就是显示在图片下面的文字，相当于对图片内容的解释。</span><br><span class="line">悬浮标题是图片的标题，当鼠标移到图片上时显示的内容。悬浮标题可加可不加</span><br></pre></td></tr></table></figure><p>比如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![NBA全明星](https://raw.githubusercontent.com/zhanghengsjtu/figureBed/main/img/20210717215222.png &quot;NBA全明星&quot;)</span><br></pre></td></tr></table></figure><p>效果如下<br><img src="https://raw.githubusercontent.com/zhanghengsjtu/figureBed/main/img/20210717215222.png" alt="NBA全明星" title="NBA全明星"><br>需要注意的是，为了保证多平台统一，图片存储时需要使用图床，提供统一的外部链接，推荐一个简单免费的图床工具。<br><strong>GitHub+Picgo搭建图床主要步骤如下：</strong></p><ul><li>建立GitHub图片仓库</li><li>创建并获取token</li><li>下载Picgo客户端</li><li>配置客户端</li></ul></li><li><p><strong>分割线</strong>：三个或者三个以上的-*都可以</p></li><li><p><strong>引用</strong>：在引用的文字前加&gt;即可。引用也可以嵌套，如加两个&gt;&gt;三个&gt;&gt;&gt;</p></li><li><p><strong>表格</strong>：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">表头|表头|表头</span><br><span class="line">---|:--:|---:</span><br><span class="line">内容|内容|内容</span><br><span class="line">内容|内容|内容</span><br><span class="line"></span><br><span class="line">第二行分割表头和内容。</span><br><span class="line">- 有一个就行，为了对齐，多加了几个</span><br><span class="line">文字默认居左</span><br><span class="line">-两边加：表示文字居中</span><br><span class="line">-右边加：表示文字居右</span><br><span class="line">注：原生的语法两边都要用 | 包起来。此处省略</span><br></pre></td></tr></table></figure><p> 效果如下：</p><table><thead><tr><th>表头</th><th align="center">表头</th><th align="right">表头</th></tr></thead><tbody><tr><td>内容</td><td align="center">内容</td><td align="right">内容</td></tr><tr><td>内容</td><td align="center">内容</td><td align="right">内容</td></tr></tbody></table></li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>到这里，我的个人博客和对Markdown语法的了解初步完成了。Markdown语法比较简单，唯一比较麻烦一些的可能就是图床的制作，相信只要大家耐心一些，肯定能够完成的。下一篇记录一下Hexo+GitHub搭建个人博客的过程。</p><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ol><li><a href="https://www.jianshu.com/p/191d1e21f7ed">https://www.jianshu.com/p/191d1e21f7ed</a></li><li><a href="https://zhuanlan.zhihu.com/p/69210764">https://zhuanlan.zhihu.com/p/69210764</a></li><li><a href="https://www.jianshu.com/p/ea1eb11db63f">https://www.jianshu.com/p/ea1eb11db63f</a></li><li><a href="https://www.cnblogs.com/ly-2019/p/11828790.html">https://www.cnblogs.com/ly-2019/p/11828790.html</a></li><li><a href="https://blog.csdn.net/yefcion/article/details/88412025">https://blog.csdn.net/yefcion/article/details/88412025</a></li></ol>]]></content>
    
    
    <summary type="html">Markdown语法</summary>
    
    
    
    <category term="Markdown" scheme="http://zhanghengsjtu.github.io/categories/Markdown/"/>
    
    
    <category term="Markdown" scheme="http://zhanghengsjtu.github.io/tags/Markdown/"/>
    
  </entry>
  
  <entry>
    <title>Hexo+Github搭建个人博客记录</title>
    <link href="http://zhanghengsjtu.github.io/2021/07/17/Hexo+Github%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    <id>http://zhanghengsjtu.github.io/2021/07/17/Hexo+Github%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</id>
    <published>2021-07-16T17:27:44.000Z</published>
    <updated>2021-07-24T22:14:10.678Z</updated>
    
    <content type="html"><![CDATA[<p>搭建博客的基本思路是先在本地创建，再部署到远端。首先本地创建时，使用Node.js + Hexo。然后远端部署时，这里使用GitHub。最后再利用比较流行的主题Next对个人博客进行美化，便于自己使用。</p><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>Hexo依赖于Node.js，下载地址为<a href="https://nodejs.org/en/download/">Download | Node.js</a>，不过win10默认已经安装了，可以先在命令行输入： node -V和 npm -V，如果已经安装成功，则该步骤可以跳过。node和npm就是安装Hexo的基础环境。</p><h3 id="Hexo博客搭建"><a href="#Hexo博客搭建" class="headerlink" title="Hexo博客搭建"></a>Hexo博客搭建</h3><ol><li><p>在D盘创建blog文件夹，然后在该文件夹下面运行：<code>npm install -g hexo-cli</code>即完成了Hexo的安装；</p></li><li><p>在D:\blog下面运行：<code>hexo init blog</code>，完成本地博客的初始化；</p></li><li><p>运行以下命令，并在浏览器输入<code>localhost:4000</code>即可看到最简单的博客</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g    <span class="comment"># 生成博客</span></span><br><span class="line">hexo s    <span class="comment"># 在服务端显示</span></span><br></pre></td></tr></table></figure></li><li><p>到此为止，本地博客最简单的版本就算搭建完成了，此时会在blog文件下面生成一系列文件，主要文件有以下几个：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blog/_config.yml            <span class="comment"># 站点配置文件，和后面同名的主题配置文件区分</span></span><br><span class="line">blog/<span class="built_in">source</span>/_posts/*.md     <span class="comment"># 生成博客的Markdown文件</span></span><br><span class="line">blog/themes                 <span class="comment"># 主题文件夹，后面会介绍，可以更换并配置主题</span></span><br></pre></td></tr></table></figure></li><li><p>另外，hexo常见的操作如下：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo -g         <span class="comment">#安装Hexo</span></span><br><span class="line">npm update hexo -g          <span class="comment">#升级</span></span><br><span class="line">hexo init                   <span class="comment">#初始化博客</span></span><br><span class="line"><span class="comment"># 上述命令基本上一次性使用</span></span><br><span class="line"><span class="comment"># 下面四条最常用</span></span><br><span class="line">hexo n <span class="string">&quot;我的博客&quot;</span> == hexo new <span class="string">&quot;我的博客&quot;</span> <span class="comment">#新建文章</span></span><br><span class="line">hexo g == hexo generate     <span class="comment">#生成</span></span><br><span class="line">hexo s == hexo server       <span class="comment">#启动服务预览</span></span><br><span class="line">hexo d == hexo deploy       <span class="comment">#部署</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="Hexo-Github线上运行"><a href="#Hexo-Github线上运行" class="headerlink" title="Hexo+Github线上运行"></a>Hexo+Github线上运行</h3><p>我们搭建博客的目的肯定不是为了只在本地运行，所以需要通过一定的技术手段将博客上传到远端。具体操作时，可以花钱购买域名，也可以使用免费的版本，这里我使用了常见的GitHub作为远端服务器。<br>在这里多说一句，GitHub在国内有时候访问速度很不理想，比如我们实验室，平时下载东西的速度能到30Mb/s，但是访问GitHub有时候就很慢，所以推荐大家购买一个靠谱的vpn并且对GitHub的访问进行合理配置，科学上网。我经常使用的vpn是<a href="https://www.myunlu.com/signin">myunlu</a>，整体使用下来还是很稳定的，我的邀请码是 5A9334B8EA51BAC53A2F8561FB156427。最后在命令行配置GitHub代理即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy socks5://127.0.0.1:1080</span><br><span class="line">git config --global https.proxy socks5://127.0.0.1:1080</span><br></pre></td></tr></table></figure><p>接下来就是正式的操作：</p><ol><li><p><strong>创建GitHub仓库</strong>，仓库名一定是<strong>username.github.io</strong></p></li><li><p><strong>安装git</strong>：win下直接下载客户端就行，其他系统同理，安装完成之后，在git bash中执行以下命令：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. git config --global user.name <span class="string">&quot;你的GitHub用户名&quot;</span></span><br><span class="line">2. git config --global user.email <span class="string">&quot;你的GitHub注册邮箱&quot;</span></span><br><span class="line">3. ssh-keygen -t rsa -C <span class="string">&quot;你的GitHub注册邮箱&quot;</span></span><br><span class="line">4. 复制生成的id_rsa.pub中的密匙，然后到GitHub-&gt;Setting-&gt;new SSH Key中配置</span><br><span class="line">5. ssh git@github.com   <span class="comment"># Hi, ***! You&#x27;ve successfully authenticated, but*** 说明成功了</span></span><br></pre></td></tr></table></figure><p> 上面的一通操作只要知道其目的就行，实质就是通过非对称加密的公钥与私钥来完成加密，公钥放置在GitHub上，私钥放置在自己的电脑里。GitHub要求每次推送代码都是合法用户，所以每次推送都需要输入账号密码验证推送用户是否是合法用户，为了省去每次输入密码的步骤，采用了ssh，当你推送的时候，git就会匹配你的私钥跟GitHub上面的公钥是否是配对的，若是匹配就认为你是合法用户，则允许推送。这样可以保证每次的推送都是正确合法的。</p></li><li><p><strong>安装git和Hexo联合部署工具</strong>：这个可以理解成GitHub对hexo的一个插件，这样使用简单的hexo命令，就可以完成GitHub部署了，该插件的安装命令为： <code>npm install hexo-deployer-git --save</code></p></li><li><p><strong>修改站点配置文件blog/_config.yam</strong></p>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>: git</span><br><span class="line">repo: https://github.com/[yourusername]/[yourusername].github.io.git</span><br><span class="line">branch: master</span><br></pre></td></tr></table></figure></li><li><p><strong>部署到远端</strong>：使用以下命令，即可将本地的博客内容部署到远端。此后，只需要用到下面的几条命令以及<a href="https://zhanghengsjtu.github.io/2021/07/17/Markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0/">Markdown语法</a>。</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo clean  <span class="comment"># 清理</span></span><br><span class="line">hexo g      <span class="comment"># 生成</span></span><br><span class="line">hexo s      <span class="comment"># 本地端口4000预览</span></span><br><span class="line">hexo d      <span class="comment"># 推到远端，所以需要上面GitHub关联，和git+hexo联合部署工具</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="Next主题配置"><a href="#Next主题配置" class="headerlink" title="Next主题配置"></a>Next主题配置</h3><p>上述三部分的功能是核心，保证了我们能够搭建最基础的博客。但是默认生成的博客页面大家可能不喜欢，在这里推荐一个比较常见的主题<a href="https://github.com/theme-next/hexo-theme-next">Next</a>。之所以推荐这个主题，和我当初选择Hexo的原因很类似：选择一个成熟好用的框架，这样有问题之后方便交流，毕竟我们的目的不是深入研究网页开发。</p><ol><li><p><strong>下载Next主题</strong>： 在blog目录下，运行命令<br><code>git clone https://github.com/iissnan/hexo-theme-next themes/next</code><br>即可将next主题下载到blog/themes/next下面，其中最重要的文件为blog/themes/next/_config.yam，我们把这个文件叫 <em><strong>主题配置文件</strong></em>，注意和上面的 <em><strong>站点配置文件</strong></em> 的区别。</p></li><li><p><strong>Next主题定制</strong><br>接下来就是根据个人喜好定制Next主题了，在这里推荐<a href="https://blog.mrzorg.top/Hexo/2020-02-12-hero-next-theme-settings/">博客1</a>，<a href="http://jeffyang.top/Hexo/Hexo%E4%B8%BB%E9%A2%98Next%E7%BE%8E%E5%8C%96/">博客2</a>，比较有用的操作主要有以下几个：</p><ul><li>修改基本信息</li><li>修改头像</li><li>修改语言</li><li>菜单设置</li><li>系统评论</li><li>访问量和统计功能</li><li>搜索功能</li></ul></li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>经过以上几个步骤，就可以搭建一个正常使用的博客了，如果对博客的搭建本身很有兴趣，可以继续查阅相关资料。在我看来，够用就好，把更多的经历放在记录上。</p><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ol><li><a href="https://zhuanlan.zhihu.com/p/26625249">https://zhuanlan.zhihu.com/p/26625249</a></li><li><a href="https://blog.mrzorg.top/Hexo/2020-02-12-hero-next-theme-settings/">https://blog.mrzorg.top/Hexo/2020-02-12-hero-next-theme-settings/</a></li><li><a href="http://jeffyang.top/Hexo/Hexo%E4%B8%BB%E9%A2%98Next%E7%BE%8E%E5%8C%96/">http://jeffyang.top/Hexo/Hexo%E4%B8%BB%E9%A2%98Next%E7%BE%8E%E5%8C%96/</a></li></ol>]]></content>
    
    
    <summary type="html">使用Hexo和GitHub构建免费个人博客</summary>
    
    
    
    <category term="Hexo" scheme="http://zhanghengsjtu.github.io/categories/Hexo/"/>
    
    
    <category term="Hexo" scheme="http://zhanghengsjtu.github.io/tags/Hexo/"/>
    
  </entry>
  
</feed>
